'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (data) {
  var result = {};

  var text = infoboxPattern.exec(data);

  if (!text) {
    return {};
  }

  text = text[0];

  // Remove comments.
  text = replaceAll('<!--.*-->', '', text);
  // Remove reference.
  text = replaceAll('<ref.*(/>|>.*</ref>)', '', text);
  // Remove all HTML tags.
  text = replaceAll('<[^>]+>', '', text);
  // Remove page regerences.
  text = replaceAll('\{\{refn[^\}\}]*?\}\}', '', text);

  // Check each line in text.
  if (text) {
    text.split('\n|').forEach(function (item) {
      var temp = item.split(' = ');

      if (temp.length === 2 && temp[1].trim() !== '') {
        // Get left part and right part.
        var itemName = temp[0].trim(),
            itemContent = temp[1].trim().split('\n')[0];

        // Extract all simple texts inside '[[ ]]',
        // such as [[France]], [[Language French|French]], etc.
        var find = itemContent.match(/\[\[.*?\]\]/g);
        if (find) {
          find.forEach(function (substring) {
            var arr = substring.split('|');
            if (arr.length === 1) {
              itemContent = itemContent.replace(substring, substring.substr(2, substring.length - 4));
            } else if (arr.length === 2) {
              itemContent = itemContent.replace(substring, arr[1].substr(0, arr[1].length - 2));
            }
          });
        }

        // Remove font style
        while (itemContent.indexOf('{{nowrap|') !== -1) {
          itemContent = itemContent.replace('{{nowrap|', '');
          itemContent = itemContent.replace('}}', '');
        }

        while (itemContent.indexOf('{{small|') !== -1) {
          itemContent = itemContent.replace('{{small|', '');
          itemContent = itemContent.replace('}}', '');
        }

        if (itemContent.indexOf('{{native') !== -1) {
          find = itemContent.match(/\{\{native[^\}\}]*?\}\}/g);
          if (find) {
            find.forEach(function (substring) {
              var arr = substring.split('|');
              itemContent = itemContent.replace(substring, arr[2]);
            });
          }
        }

        // Remove list tag
        if (itemContent.indexOf('{{unbulleted') !== -1) {
          find = itemContent.match(/\{\{unbulleted[^\}\}]*?\}\}/g);
          if (find) {
            find.forEach(function (substring) {
              var arr = substring.split('|');
              arr.shift();
              itemContent = itemContent.replace(substring, arr.join(',').replace('}}', ''));
            });
          }
        }

        // Remove simple vertical list tag
        if (itemContent.indexOf('{{vunblist') !== -1 && itemContent.split('{{').length < 3) {
          find = itemContent.match(/\{\{vunblist[^\}\}]*?\}\}/g);
          if (find) {
            find.forEach(function (substring) {
              var arr = substring.split('|');
              arr.shift();
              itemContent = itemContent.replace(substring, arr.join(',').replace('}}', ''));
            });
          }
        }

        // Remove horizon list tag
        if (itemContent.indexOf('{{hlist') !== -1) {
          find = itemContent.match(/\{\{hlist[^\}\}]*?\}\}/g);
          if (find) {
            find.forEach(function (substring) {
              var arr = substring.split('|');
              arr.shift();
              itemContent = itemContent.replace(substring, arr.join(',').replace('}}', ''));
            });
          }
        }

        // Remove efn tag
        if (itemContent.indexOf('{{efn') !== -1) {
          find = itemContent.match(/\{\{efn[^\}\}]*?\}\}/g);
          if (find) {
            find.forEach(function (substring) {
              itemContent = itemContent.replace(substring, '');
            });
          }
        }

        itemContent = replaceAll('&nbsp', ' ', itemContent);
        itemContent = replaceAll('\n\}\}', '', itemContent);
        result[itemName] = itemContent;
      }
    });
  }

  return result;
};

var infoboxPattern = /{{[Ii]nfobox(.|\n)*}}/g;

function replaceAll(find, replace, str) {
  if (str) {
    return str.replace(new RegExp(find, 'gm'), replace).trim();
  } else {
    return null;
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy93aWtpLW1hcmt1cC1wYXJzZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O2tCQVVlLFVBQVMsSUFBVCxFQUFlO0FBQzVCLE1BQUksU0FBUyxFQUFiOztBQUVBLE1BQUksT0FBTyxlQUFlLElBQWYsQ0FBb0IsSUFBcEIsQ0FBWDs7QUFFQSxNQUFJLENBQUMsSUFBTCxFQUFXO0FBQ1QsV0FBTyxFQUFQO0FBQ0Q7O0FBRUQsU0FBTyxLQUFLLENBQUwsQ0FBUDs7O0FBR0EsU0FBTyxXQUFXLFdBQVgsRUFBd0IsRUFBeEIsRUFBNEIsSUFBNUIsQ0FBUDs7QUFFQSxTQUFPLFdBQVcsc0JBQVgsRUFBbUMsRUFBbkMsRUFBdUMsSUFBdkMsQ0FBUDs7QUFFQSxTQUFPLFdBQVcsU0FBWCxFQUFzQixFQUF0QixFQUEwQixJQUExQixDQUFQOztBQUVBLFNBQU8sV0FBVyx1QkFBWCxFQUFvQyxFQUFwQyxFQUF3QyxJQUF4QyxDQUFQOzs7QUFHQSxNQUFJLElBQUosRUFBVTtBQUNSLFNBQUssS0FBTCxDQUFXLEtBQVgsRUFBa0IsT0FBbEIsQ0FBMEIsVUFBUyxJQUFULEVBQWU7QUFDdkMsVUFBSSxPQUFPLEtBQUssS0FBTCxDQUFXLEtBQVgsQ0FBWDs7QUFFQSxVQUFJLEtBQUssTUFBTCxLQUFnQixDQUFoQixJQUFxQixLQUFLLENBQUwsRUFBUSxJQUFSLE9BQW1CLEVBQTVDLEVBQWdEOztBQUU5QyxZQUFJLFdBQVcsS0FBSyxDQUFMLEVBQVEsSUFBUixFQUFmO1lBQ0UsY0FBYyxLQUFLLENBQUwsRUFBUSxJQUFSLEdBQWUsS0FBZixDQUFxQixJQUFyQixFQUEyQixDQUEzQixDQURoQjs7OztBQUtBLFlBQUksT0FBTyxZQUFZLEtBQVosQ0FBa0IsY0FBbEIsQ0FBWDtBQUNBLFlBQUksSUFBSixFQUFVO0FBQ1IsZUFBSyxPQUFMLENBQWEsVUFBUyxTQUFULEVBQW9CO0FBQy9CLGdCQUFJLE1BQU0sVUFBVSxLQUFWLENBQWdCLEdBQWhCLENBQVY7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QW9CO0FBQy9CLGtCQUFJLE1BQU0sVUFBVSxLQUFWLENBQWdCLEdBQWhCLENBQVY7QUFDQSxrQkFBSSxLQUFKO0FBQ0EsNEJBQWMsWUFBWSxPQUFaLENBQW9CLFNBQXBCLEVBQStCLElBQUksSUFBSixDQUFTLEdBQVQsRUFBYyxPQUFkLENBQXNCLElBQXRCLEVBQTRCLEVBQTVCLENBQS9CLENBQWQ7QUFDRCxhQUpEO0FBS0Q7QUFDRjs7O0FBR0QsWUFBSSxZQUFZLE9BQVosQ0FBb0IsT0FBcEIsTUFBaUMsQ0FBQyxDQUF0QyxFQUF5QztBQUN2QyxpQkFBTyxZQUFZLEtBQVosQ0FBa0IsdUJBQWxCLENBQVA7QUFDQSxjQUFJLElBQUosRUFBVTtBQUNSLGlCQUFLLE9BQUwsQ0FBYSxVQUFTLFNBQVQsRUFBb0I7QUFDL0IsNEJBQWMsWUFBWSxPQUFaLENBQW9CLFNBQXBCLEVBQStCLEVBQS9CLENBQWQ7QUFDRCxhQUZEO0FBR0Q7QUFDRjs7QUFFRCxzQkFBYyxXQUFXLE9BQVgsRUFBb0IsR0FBcEIsRUFBeUIsV0FBekIsQ0FBZDtBQUNBLHNCQUFjLFdBQVcsUUFBWCxFQUFxQixFQUFyQixFQUF5QixXQUF6QixDQUFkO0FBQ0EsZUFBTyxRQUFQLElBQW1CLFdBQW5CO0FBQ0Q7QUFDRixLQWhHRDtBQWlHRDs7QUFFRCxTQUFPLE1BQVA7QUFDRCxDOztBQXBJRCxJQUFJLGlCQUFpQix3QkFBckI7O0FBRUEsU0FBUyxVQUFULENBQW9CLElBQXBCLEVBQTBCLE9BQTFCLEVBQW1DLEdBQW5DLEVBQXdDO0FBQ3RDLE1BQUksR0FBSixFQUFTO0FBQ1AsV0FBTyxJQUFJLE9BQUosQ0FBWSxJQUFJLE1BQUosQ0FBVyxJQUFYLEVBQWlCLElBQWpCLENBQVosRUFBb0MsT0FBcEMsRUFBNkMsSUFBN0MsRUFBUDtBQUNELEdBRkQsTUFFTztBQUNMLFdBQU8sSUFBUDtBQUNEO0FBQ0YiLCJmaWxlIjoid2lraS1tYXJrdXAtcGFyc2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGluZm9ib3hQYXR0ZXJuID0gL3t7W0lpXW5mb2JveCgufFxcbikqfX0vZztcblxuZnVuY3Rpb24gcmVwbGFjZUFsbChmaW5kLCByZXBsYWNlLCBzdHIpIHtcbiAgaWYgKHN0cikge1xuICAgIHJldHVybiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKGZpbmQsICdnbScpLCByZXBsYWNlKS50cmltKCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24oZGF0YSkge1xuICB2YXIgcmVzdWx0ID0ge307XG5cbiAgdmFyIHRleHQgPSBpbmZvYm94UGF0dGVybi5leGVjKGRhdGEpO1xuXG4gIGlmICghdGV4dCkge1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIHRleHQgPSB0ZXh0WzBdO1xuXG4gIC8vIFJlbW92ZSBjb21tZW50cy5cbiAgdGV4dCA9IHJlcGxhY2VBbGwoJzwhLS0uKi0tPicsICcnLCB0ZXh0KTtcbiAgLy8gUmVtb3ZlIHJlZmVyZW5jZS5cbiAgdGV4dCA9IHJlcGxhY2VBbGwoJzxyZWYuKigvPnw+Lio8L3JlZj4pJywgJycsIHRleHQpO1xuICAvLyBSZW1vdmUgYWxsIEhUTUwgdGFncy5cbiAgdGV4dCA9IHJlcGxhY2VBbGwoJzxbXj5dKz4nLCAnJywgdGV4dCk7XG4gIC8vIFJlbW92ZSBwYWdlIHJlZ2VyZW5jZXMuXG4gIHRleHQgPSByZXBsYWNlQWxsKCdcXHtcXHtyZWZuW15cXH1cXH1dKj9cXH1cXH0nLCAnJywgdGV4dCk7XG5cbiAgLy8gQ2hlY2sgZWFjaCBsaW5lIGluIHRleHQuXG4gIGlmICh0ZXh0KSB7XG4gICAgdGV4dC5zcGxpdCgnXFxufCcpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgdmFyIHRlbXAgPSBpdGVtLnNwbGl0KCcgPSAnKTtcblxuICAgICAgaWYgKHRlbXAubGVuZ3RoID09PSAyICYmIHRlbXBbMV0udHJpbSgpICE9PSAnJykge1xuICAgICAgICAvLyBHZXQgbGVmdCBwYXJ0IGFuZCByaWdodCBwYXJ0LlxuICAgICAgICB2YXIgaXRlbU5hbWUgPSB0ZW1wWzBdLnRyaW0oKSxcbiAgICAgICAgICBpdGVtQ29udGVudCA9IHRlbXBbMV0udHJpbSgpLnNwbGl0KCdcXG4nKVswXTtcblxuICAgICAgICAvLyBFeHRyYWN0IGFsbCBzaW1wbGUgdGV4dHMgaW5zaWRlICdbWyBdXScsXG4gICAgICAgIC8vIHN1Y2ggYXMgW1tGcmFuY2VdXSwgW1tMYW5ndWFnZSBGcmVuY2h8RnJlbmNoXV0sIGV0Yy5cbiAgICAgICAgdmFyIGZpbmQgPSBpdGVtQ29udGVudC5tYXRjaCgvXFxbXFxbLio/XFxdXFxdL2cpO1xuICAgICAgICBpZiAoZmluZCkge1xuICAgICAgICAgIGZpbmQuZm9yRWFjaChmdW5jdGlvbihzdWJzdHJpbmcpIHtcbiAgICAgICAgICAgIHZhciBhcnIgPSBzdWJzdHJpbmcuc3BsaXQoJ3wnKTtcbiAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgIGl0ZW1Db250ZW50ID0gaXRlbUNvbnRlbnQucmVwbGFjZShzdWJzdHJpbmcsXG4gICAgICAgICAgICAgICAgc3Vic3RyaW5nLnN1YnN0cigyLCBzdWJzdHJpbmcubGVuZ3RoIC0gNCkpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChhcnIubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICAgIGl0ZW1Db250ZW50ID0gaXRlbUNvbnRlbnQucmVwbGFjZShzdWJzdHJpbmcsXG4gICAgICAgICAgICAgICAgYXJyWzFdLnN1YnN0cigwLCBhcnJbMV0ubGVuZ3RoIC0gMikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVtb3ZlIGZvbnQgc3R5bGVcbiAgICAgICAgd2hpbGUgKGl0ZW1Db250ZW50LmluZGV4T2YoJ3t7bm93cmFwfCcpICE9PSAtMSkge1xuICAgICAgICAgIGl0ZW1Db250ZW50ID0gaXRlbUNvbnRlbnQucmVwbGFjZSgne3tub3dyYXB8JywgJycpO1xuICAgICAgICAgIGl0ZW1Db250ZW50ID0gaXRlbUNvbnRlbnQucmVwbGFjZSgnfX0nLCAnJyk7XG4gICAgICAgIH1cblxuICAgICAgICB3aGlsZSAoaXRlbUNvbnRlbnQuaW5kZXhPZigne3tzbWFsbHwnKSAhPT0gLTEpIHtcbiAgICAgICAgICBpdGVtQ29udGVudCA9IGl0ZW1Db250ZW50LnJlcGxhY2UoJ3t7c21hbGx8JywgJycpO1xuICAgICAgICAgIGl0ZW1Db250ZW50ID0gaXRlbUNvbnRlbnQucmVwbGFjZSgnfX0nLCAnJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXRlbUNvbnRlbnQuaW5kZXhPZigne3tuYXRpdmUnKSAhPT0gLTEpIHtcbiAgICAgICAgICBmaW5kID0gaXRlbUNvbnRlbnQubWF0Y2goL1xce1xce25hdGl2ZVteXFx9XFx9XSo/XFx9XFx9L2cpO1xuICAgICAgICAgIGlmIChmaW5kKSB7XG4gICAgICAgICAgICBmaW5kLmZvckVhY2goZnVuY3Rpb24oc3Vic3RyaW5nKSB7XG4gICAgICAgICAgICAgIHZhciBhcnIgPSBzdWJzdHJpbmcuc3BsaXQoJ3wnKTtcbiAgICAgICAgICAgICAgaXRlbUNvbnRlbnQgPSBpdGVtQ29udGVudC5yZXBsYWNlKHN1YnN0cmluZywgYXJyWzJdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlbW92ZSBsaXN0IHRhZ1xuICAgICAgICBpZiAoaXRlbUNvbnRlbnQuaW5kZXhPZigne3t1bmJ1bGxldGVkJykgIT09IC0xKSB7XG4gICAgICAgICAgZmluZCA9IGl0ZW1Db250ZW50Lm1hdGNoKC9cXHtcXHt1bmJ1bGxldGVkW15cXH1cXH1dKj9cXH1cXH0vZyk7XG4gICAgICAgICAgaWYgKGZpbmQpIHtcbiAgICAgICAgICAgIGZpbmQuZm9yRWFjaChmdW5jdGlvbihzdWJzdHJpbmcpIHtcbiAgICAgICAgICAgICAgdmFyIGFyciA9IHN1YnN0cmluZy5zcGxpdCgnfCcpO1xuICAgICAgICAgICAgICBhcnIuc2hpZnQoKTtcbiAgICAgICAgICAgICAgaXRlbUNvbnRlbnQgPSBpdGVtQ29udGVudC5yZXBsYWNlKHN1YnN0cmluZywgYXJyLmpvaW4oJywnKS5yZXBsYWNlKCd9fScsICcnKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZW1vdmUgc2ltcGxlIHZlcnRpY2FsIGxpc3QgdGFnXG4gICAgICAgIGlmIChpdGVtQ29udGVudC5pbmRleE9mKCd7e3Z1bmJsaXN0JykgIT09IC0xICYmXG4gICAgICAgICAgaXRlbUNvbnRlbnQuc3BsaXQoJ3t7JykubGVuZ3RoIDwgMykge1xuICAgICAgICAgIGZpbmQgPSBpdGVtQ29udGVudC5tYXRjaCgvXFx7XFx7dnVuYmxpc3RbXlxcfVxcfV0qP1xcfVxcfS9nKTtcbiAgICAgICAgICBpZiAoZmluZCkge1xuICAgICAgICAgICAgZmluZC5mb3JFYWNoKGZ1bmN0aW9uKHN1YnN0cmluZykge1xuICAgICAgICAgICAgICB2YXIgYXJyID0gc3Vic3RyaW5nLnNwbGl0KCd8Jyk7XG4gICAgICAgICAgICAgIGFyci5zaGlmdCgpO1xuICAgICAgICAgICAgICBpdGVtQ29udGVudCA9IGl0ZW1Db250ZW50LnJlcGxhY2Uoc3Vic3RyaW5nLCBhcnIuam9pbignLCcpLnJlcGxhY2UoJ319JywgJycpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlbW92ZSBob3Jpem9uIGxpc3QgdGFnXG4gICAgICAgIGlmIChpdGVtQ29udGVudC5pbmRleE9mKCd7e2hsaXN0JykgIT09IC0xKSB7XG4gICAgICAgICAgZmluZCA9IGl0ZW1Db250ZW50Lm1hdGNoKC9cXHtcXHtobGlzdFteXFx9XFx9XSo/XFx9XFx9L2cpO1xuICAgICAgICAgIGlmIChmaW5kKSB7XG4gICAgICAgICAgICBmaW5kLmZvckVhY2goZnVuY3Rpb24oc3Vic3RyaW5nKSB7XG4gICAgICAgICAgICAgIHZhciBhcnIgPSBzdWJzdHJpbmcuc3BsaXQoJ3wnKTtcbiAgICAgICAgICAgICAgYXJyLnNoaWZ0KCk7XG4gICAgICAgICAgICAgIGl0ZW1Db250ZW50ID0gaXRlbUNvbnRlbnQucmVwbGFjZShzdWJzdHJpbmcsIGFyci5qb2luKCcsJykucmVwbGFjZSgnfX0nLCAnJykpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVtb3ZlIGVmbiB0YWdcbiAgICAgICAgaWYgKGl0ZW1Db250ZW50LmluZGV4T2YoJ3t7ZWZuJykgIT09IC0xKSB7XG4gICAgICAgICAgZmluZCA9IGl0ZW1Db250ZW50Lm1hdGNoKC9cXHtcXHtlZm5bXlxcfVxcfV0qP1xcfVxcfS9nKTtcbiAgICAgICAgICBpZiAoZmluZCkge1xuICAgICAgICAgICAgZmluZC5mb3JFYWNoKGZ1bmN0aW9uKHN1YnN0cmluZykge1xuICAgICAgICAgICAgICBpdGVtQ29udGVudCA9IGl0ZW1Db250ZW50LnJlcGxhY2Uoc3Vic3RyaW5nLCAnJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpdGVtQ29udGVudCA9IHJlcGxhY2VBbGwoJyZuYnNwJywgJyAnLCBpdGVtQ29udGVudCk7XG4gICAgICAgIGl0ZW1Db250ZW50ID0gcmVwbGFjZUFsbCgnXFxuXFx9XFx9JywgJycsIGl0ZW1Db250ZW50KTtcbiAgICAgICAgcmVzdWx0W2l0ZW1OYW1lXSA9IGl0ZW1Db250ZW50O1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn0iXX0=